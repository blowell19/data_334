---
title: "class_prep5"
format: html
editor: visual
---

```{r}
library(tidyverse)
library(here)
theme_set(theme_minimal())
hpi_df <- read_csv("https://raw.githubusercontent.com/highamm/ds234_quarto/main/data_online/hpi-tidy.csv")
hpi_df
```

## Exercises

1.  Mutate is how to make a new variable or modify an existing one. Arrange is used to sort the data based on a set parameter such as descending or ascending order. Select is used to select specific columns, while slice is used to choose certain rows. Filter is pretty self explanatory, it can be used with a set paramter to filter the data that is shown. Group by can be used to group variables with a certain shared parameter together. Summarize can be used to find statistical summary numbers such as min, max, mean, sample size.

2.  

```{r}
hpi_df = hpi_df %>%
  mutate(WellbeingFootprint = (Wellbeing/Footprint))
```

3.  

```{r}
hpi_df = hpi_df %>%
  mutate(
    decade = case_when(
      LifeExpectancy >= 80 ~ "80s",
      LifeExpectancy >= 70 & LifeExpectancy < 80 ~ "70s",
      LifeExpectancy < 70 ~ "Below 70s"
    )
  )
```

4.  

```{r}
hpi_df %>%
  arrange(desc(LifeExpectancy))
```

5.  

```{r}
hpi_df %>%
  select(Country, LifeExpectancy)
```

6.  

```{r}
hpi_df %>%
  slice(1:5)
```

7.  

```{r}
hpi_df %>%
  filter(Region == "Western World")
```

8.  

```{r}
hpi_df %>%
  filter(LifeExpectancy < 55)
```

9.  

```{r}
hpi_df %>%
  group_by(Region) %>%
  summarize(total = n())
```

10. 

```{r}
hpi_df %>%
  group_by(Region) %>%
  summarize(max(LifeExpectancy))
```

# Section 5.3

## Exercise 2
```{r}
library(readxl)
library(here)
majors_df = read_excel(here::here("data/slu_graduates_17_25.xlsx"))
```

```{r}
library(tidyverse)
library(readxl)
library(here)
df <- read_excel(here::here("data/slu_graduates_17_25.xlsx"))

## one row per student
df

## fixes error in the data
df <- df |> mutate(across(everything(),
                          .fns = ~replace(., . ==  "STATS" , "STAT")))

majors_long <- df |> select(-starts_with("minor")) |>
  pivot_longer(starts_with("major"), names_to = "major_num",
               values_to = "major") |>
  filter(!is.na(major))

## double majors now are in two rows
majors_long
```

Make a lollipop plot plot of the proportion of Males for each major.
Hint: create indicator variable for sex (1 for male, 0 for female)

```{r}
majors_prop = majors_long %>%
  mutate(
    Male = if_else(sex == "M", 1, 0)) %>%
  group_by(major) %>%
     summarize(mean_male = mean(Male), n_students = n())%>%
  mutate(major = fct_reorder(major, mean_male)) %>%
  mutate(mcss_var = if_else(major %in% c("MATH","CS","STAT", "EC_MA"), true = "mcss", false = "other")) %>%
  filter(n_students >= 45)
```

```{r}
ggplot(data = majors_prop, aes(x = mean_male, y = major, color = mcss_var, size = mcss_var))+
  geom_segment(aes(yend = major, x = 0, xend = mean_male), show.legend = FALSE)+
  geom_point(show.legend = FALSE)+
  theme_minimal()+
  scale_color_manual(values = c("hotpink", "grey60" )) +
  scale_size_manual(values = c(2, 1))

## Maybe we only want to plot majors with at least 45 students (avg 5 per year).
```

